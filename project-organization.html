<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Shiro Kuriwaki (kuriwaki@g.harvard.edu)" />

<meta name="date" content="2017-11-14" />

<title>Best Practices for Project Organization in the Empirical Policy and Social Science Analhysis</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Best Practices for Project Organization in the Empirical Policy and Social Science Analhysis</h1>
<h4 class="author"><em>Shiro Kuriwaki (<a href="mailto:kuriwaki@g.harvard.edu">kuriwaki@g.harvard.edu</a>)</em></h4>
<h4 class="date"><em>2017-11-14</em></h4>



<blockquote>
<p>Saying [social science researchers] should spend more time thinking about the way they write code would be like telling a novelist that she should spend more time thinking about how best to use Microsoft Word. – Gentzkow and Shapiro (2014)</p>
</blockquote>
<p>This brief memo outlines one way to organize an empirical project in the Social Sciences, an area that is increasingly data-driven, program-driven, and collaborative. I rely most on the excellent writeup by economists Matthew Gentzkow and Jesse Shapiro, “Code and Data for the Social Sciences: A Practitioner’s Guide”, as well as other resources that have established best practices. My intent is to summarize the key points and update with new resources, rather than re-invent the wheel.</p>
<p>(prepared for API 201-Z optional session )</p>
<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>Learning how to write on new apps may sound like an optional hobby that “just” makes things look nice (as the opening quote indicates). That is only partially true – good organization and the use of appropriate tools improve the quality of your work, and more prominently, reduce the number of errors you make, thereby optimizing on your time.</p>
<p>The environment for data analysis and presentation is rapidly increasing. Only recently have we seen: - Many organizations handling <strong>more data</strong> at cheaper cost - Many data analysis and version control tools becoming <strong>open source</strong> - Online <strong>collaboration</strong> becoming more prevalent - Computer science and statistics attracting more students</p>
<p>and with these challenges come new tools to pick up.</p>
<p>Learning these tricks is an investment, but a little training on well-tested best practices can go a long way.</p>
</div>
<div id="original-principles-by-gentzkow-and-shapiro" class="section level2">
<h2>Original Principles by Gentzkow and Shapiro</h2>
<p>The recommendations by Gentzkow and Shapiro are central:</p>
<ol style="list-style-type: decimal">
<li>Automation</li>
</ol>
<ul>
<li>Automate everything that can be automated</li>
<li>Write a single script that executes all code from beginning to end</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Version Control</li>
</ol>
<ul>
<li>Store code and data under version control</li>
<li>Run the whole directory before checking it back in</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Directories (Folder Structure)</li>
</ol>
<ul>
<li>Separate directories by function</li>
<li>Separate files into inputs and outputs</li>
<li>Make directories portable</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Keys</li>
</ol>
<ul>
<li>Store cleaned data in tables with unique, non-missing keys</li>
<li>Keep data normalized as far into your code pipeline as you can.</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Abstraction</li>
</ol>
<ul>
<li>Abstract to eliminate redundancy.</li>
<li>Abstract to improve clarity.</li>
<li>Otherwise, don’t abstract.</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>Documentation</li>
</ol>
<ul>
<li>Don’t write documentation you will not maintain.</li>
<li>Code should be self-documenting.</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>Management</li>
</ol>
<ul>
<li>Manage tasks with a task management system.</li>
<li>E-mail is not a task management system.</li>
</ul>
<ol start="8" style="list-style-type: decimal">
<li>Code style</li>
</ol>
<ul>
<li>Keep it short and purposeful</li>
<li>Make your functions shy</li>
<li>Order your functions for linear reading</li>
<li>Use descriptive names</li>
<li>Pay special attention to coding algebra</li>
<li>Make logical switches intuitive</li>
<li>Be consistent</li>
<li>Check for errors</li>
<li>Write tests</li>
<li>Profile slow code relentlessly.</li>
<li>Store “too much” output from slow code</li>
<li>Separate slow code from fast code</li>
</ul>
</div>
<div id="gentzkow-and-shapiro-modified" class="section level2">
<h2>Gentzkow and Shapiro, modified</h2>
<p>A version of the above tailored to those whose main job is not research, but data analysis.</p>
</div>
<div id="priniciples" class="section level2">
<h2>Priniciples</h2>
<ol style="list-style-type: decimal">
<li>Automation</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Automate everything that can be automated</li>
<li>Each script should executes all code from beginning to end</li>
<li>Embed Figures and Tables to auto-update in your document</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>Abstraction</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Abstract to eliminate redundancy.</li>
<li>Abstract to improve clarity.</li>
<li>Otherwise, don’t abstract.</li>
</ol>
</div>
<div id="organization" class="section level2">
<h2>Organization</h2>
<ol start="3" style="list-style-type: decimal">
<li>Directories (Folder Structure)</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Separate directories by function</li>
<li>Separate files into inputs and outputs</li>
<li>Make directories portable</li>
</ol>
<ol start="4" style="list-style-type: decimal">
<li>Datasets</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Store cleaned data in tables with unique, non-missing keys</li>
</ol>
<ol start="5" style="list-style-type: decimal">
<li>Code organization</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>One script for one step (build, analyze, figures)</li>
</ol>
</div>
<div id="management" class="section level2">
<h2>Management</h2>
<ol start="6" style="list-style-type: decimal">
<li>Documentation</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Don’t write documentation you will not maintain.</li>
<li>Code should be self-documenting.</li>
</ol>
<ol start="7" style="list-style-type: decimal">
<li>Management</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Manage tasks with a task management system.</li>
<li>E-mail is not <em>the best</em> task management system: Git is the best, with a middle-ground with Dropbox Paper, Tasks in Google Docs, Slack.</li>
<li>Use a version control system</li>
</ol>
<ol start="8" style="list-style-type: decimal">
<li>Open-sourcing</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Consider Open-sourcing your datasets, figures, or code</li>
</ol>
</div>
<div id="production" class="section level2">
<h2>Production</h2>
<ol start="9" style="list-style-type: decimal">
<li>Writing Software</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Use an editor you have the most control over (preferably not WYSIWIG)</li>
</ol>
<ol start="10" style="list-style-type: decimal">
<li>Figures and Tables</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>One message per figure/table</li>
<li>Maximize the data-ink ratio</li>
<li>Drop unnnecessary digits</li>
<li>Modify aspect-ratios of figures</li>
</ol>
<ol start="11" style="list-style-type: decimal">
<li>Code style</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Use descriptive names</li>
<li>Don’t repeat code more than twice</li>
<li>Keep it short and purposeful</li>
<li>Make your functions shy</li>
<li>Be consistent</li>
<li>Write tests</li>
</ol>
<ol start="12" style="list-style-type: decimal">
<li>Typesetting</li>
</ol>
<ol style="list-style-type: lower-roman">
<li>Use generous margins</li>
<li>Use a consistent font</li>
</ol>
</div>
<div id="automation" class="section level2">
<h2>Automation</h2>
<ol style="list-style-type: lower-roman">
<li>Automate everything that can be automated</li>
<li>Each script should executes all code from beginning to end</li>
<li>Embed Figures and Tables to auto-update in your document</li>
</ol>
<p>You will be revising your analysis and writeup many more times than you anticipate. That’s why short and automated code is essential.</p>
<p>For example, these lines of code reads in data from Google Sheets, formats it, and loads the necessary packages, and saves a figure of a printable size.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googlesheets)

gapminder_sheet &lt;-<span class="st"> </span><span class="kw">gs_gap</span>()
df &lt;-<span class="st"> </span><span class="kw">gs_read</span>(gapminder_sheet, <span class="dt">ws =</span> <span class="st">&quot;Africa&quot;</span>, <span class="dt">col_types =</span> <span class="kw">cols</span>())

<span class="co"># look at data</span>
<span class="kw">glimpse</span>(df)

df<span class="op">$</span>log_gdppercap &lt;-<span class="st"> </span><span class="kw">log</span>(df<span class="op">$</span>gdpPercap)

<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> log_gdppercap, <span class="dt">y =</span> lifeExp, <span class="dt">size =</span> pop)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>year, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_label</span>(<span class="dt">data =</span> <span class="kw">filter</span>(df, country <span class="op">%in%</span><span class="st"> &quot;Rwanda&quot;</span>), <span class="kw">aes</span>(<span class="dt">label =</span> country)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">size =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;log GDP per Capita&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Average Life Expectancy&quot;</span>)

<span class="kw">ggsave</span>(<span class="st">&quot;figures/gapminder_africa.pdf&quot;</span>, <span class="dt">width =</span> <span class="dv">5</span>, <span class="dt">height =</span> <span class="dv">3</span>)</code></pre></div>
<p>Then, an text editor like Rmarkdown or LaTeX compiles a plain text file that embeds this Figure.</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">Project</span> Report
============
<span class="ex">Shiro</span> Kuriwaki

<span class="co"># Introduction</span>

<span class="co"># Data</span>


<span class="co"># Analysis</span>
![<span class="ex">Rwanda</span><span class="st">'s Civil War led to a substnantial Drop in its Life Expectancy](figures/gapminder_africa.pdf)</span></code></pre></div>
</div>
<div id="abstraction" class="section level1">
<h1>Abstraction</h1>
<ol style="list-style-type: lower-roman">
<li>Abstract to eliminate redundancy.</li>
<li>Abstract to improve clarity.</li>
<li>Otherwise, don’t abstract.</li>
</ol>
<p>It is also normal for you to try something out and then do another version of that. Suppose that, in analyzing Brazilian municipality data, we want to generate a new variable that computes the difference in a municipality’s literacy level with its state-average. In Stata you would try</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"> <span class="ex">egen</span> mean_literate91 = mean(literate91), <span class="ex">by</span>(state)
 <span class="ex">generate</span> relative_lit_state = mean_literate91  - literate</code></pre></div>
<p>and then look at a histogram,</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">histogram</span> relative_lit_state</code></pre></div>
<p>Intrigued, suppose you want to do the same type of calculation but with a different variable, the poverty rate. A redundant but common next step is to copy-paste the two lines of code and make sure to replace the relevant parts:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"> <span class="ex">egen</span> mean_poverty91 = mean(poverty91), <span class="ex">by</span>(state)
 <span class="ex">generate</span> relative_pov_state = mean_poverty91  - poverty91
 <span class="ex">histogram</span> relative_pov_state</code></pre></div>
<p>What about doing the same thing not by state, but by region? And so on and so on.. you end up with lines of code that is redundant in terms of the key operation (compute means, subtract the mean from the value); only the variables have changed. After a while, you get tired of copy-pasting and tediously editing so you stop analyzing the data and move out. Even worse, you make a copy-paste error and forget to swap a variable.</p>
<p>Here’s where the abstraction via defining your own function becomes important:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">program</span> hist_relative_rate
         <span class="ex">syntax</span>, invar(varname) <span class="ex">outvar</span>(name) <span class="ex">byvar</span>(varname)
         <span class="ex">tempvar</span> mean_invar
         <span class="ex">egen</span> <span class="kw">`</span><span class="ex">mean_invar</span><span class="st">'= mean(`invar'</span>), <span class="ex">by</span>(<span class="kw">`</span>byvar<span class="st">')</span>
<span class="st">         gen `outvar'</span> = <span class="kw">`</span><span class="ex">mean_invar</span><span class="st">' - `invar'</span>
         <span class="ex">histogram</span> <span class="kw">`</span>outvar<span class="st">'</span>
<span class="st">end</span></code></pre></div>
<p>Now we can do the same function with only one line of code!</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="ex">hist_relative_rate</span>, invar(poverty80) <span class="ex">outvar</span>(relative_pov80_state) <span class="ex">byvar</span>(state)</code></pre></div>
<p>Moreover, repeating the same procedure with different variables requires you only write as many lines as there are different specifications, rather than having the extra <code>egen</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hist_relative_rate, <span class="kw">invar</span>(poverty80) <span class="kw">outvar</span>(relative_pov80_state) <span class="kw">byvar</span>(state)
hist_relative_rate, <span class="kw">invar</span>(poverty91) <span class="kw">outvar</span>(relative_pov91_state) <span class="kw">byvar</span>(state)
hist_relative_rate, <span class="kw">invar</span>(poverty80) <span class="kw">outvar</span>(relative_pov80_region) <span class="kw">byvar</span>(region)</code></pre></div>
<p>Not only is this fewer keystrokes, it is much more <strong>readable</strong>. It is clear what the function <code>hist_relative_rate</code> is essentially doing, whereas understanding three lines takes more time than people have time for. We’ll see later that adding comments to this code is also not a great idea, because that documentation can quickly become deprecated.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
